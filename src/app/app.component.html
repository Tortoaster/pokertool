<main>
  @if (connecting()) {
    <div class="center">
      <app-throbber/>
    </div>
  } @else {
    <div class="slots">
      <!-- TODO fix tracking -->
      @for (card of state.cards; track card.userId) {
        <div class="slot">
          @if(card.value != null) {
            <app-card [value]="card.value" [flipped]="!(state.revealed || card.userId == userService.getUser())" />
          }
        </div>
      }
    </div>


    <div class="button-bar">
      @if (state.host) {
        <app-button (onClick)="revealConceal()" [disabled]="synchronizing() || connecting()">
          @if (state.revealed) { Hide } @else { Reveal }
        </app-button>
        <app-button (onClick)="reset()" [disabled]="synchronizing() || connecting()">
          Reset
        </app-button>
      }
      @if(spectating()) {
      <app-button (onClick)="join()" [disabled]="synchronizing() || connecting()">
        Join
      </app-button>
      } @else {
      <app-button (onClick)="spectate()" [disabled]="synchronizing() || connecting()">
        Spectate
      </app-button>
      }
    </div>

    <div class="hand" [class.hidden]="state.revealed || connecting() || spectating()">
      <app-hand (cardChange)="playCard($event)" [disabled]="synchronizing() || state.revealed || connecting()" [hidden]="state.revealed || connecting()"/>
    </div>
  }
</main>

<router-outlet/>
